import { expect, it } from 'vitest'
import { atom, useAtomValue, useSetAtom } from '../src/lib'
import { flushSync } from 'ripple'

it('useAtomValue basic test', async () => {
  const countAtom = atom(0)

  component Counter() {
    const count = useAtomValue(countAtom)
    const setCount = useSetAtom(countAtom)

    <p>{`count: ${@count}`}</p>
    <button onClick={() => setCount(@count + 1)}>{'dispatch'}</button>
  }

  render(Counter)
  flushSync();

  expect(container.querySelector('p').textContent).toBe('count: 0');

  const button = container.querySelector('button');
  button.click();
  flushSync();

  expect(container.querySelector('p').textContent).toBe('count: 1');
})
